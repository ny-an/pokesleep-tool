import{P as A,c as T,M as O,e as k,h as B,w as H,A as b,m as v,S as w,a as d,N as x}from"./api-util-CLXy59Nx.js";import{I as U}from"./api-data-BXi2R70q.js";class _{index;type;rankNumber;thisStrength;nextStrength;constructor(e,n){let o=0;for(let l=0;l<n.length&&!(e<n[l]);l++)o=l;this.index=o,this.thisStrength=n[o],this.nextStrength=n[o+1],this.type=_.rankIndexToType(o),this.rankNumber=_.rankIndexToRankNumber(o)}static rankIndexToType(e){return e<5?"basic":e<10?"great":e<15?"ultra":"master"}static rankIndexToRankNumber(e){return e<15?e%5+1:e-14}}class L{_minutes;_h;_m;constructor(e){this._minutes=e,this._h=Math.floor(e/60),this._m=Math.round(e%60)}get h(){return this._h}get m(){return this._m}get score(){return Math.min(100,Math.round(this._minutes/510*100))}toString(e){return e("hhmm",{h:this.h,m:this.m})}}function W(i,e){for(let n=1;n<6;n++)if(e<i[n])return n+2;return 8}class C{_entries=[];static get maxEntryCount(){return 300}constructor(e){this._entries=e||[]}get items(){return this._entries}get canAdd(){return this._entries.length<C.maxEntryCount}add(e,n){if(!this.canAdd)throw new Error("max entry count exceeds");const o=new S(e,n);return this._entries=[...this._entries,o],o.id}remove(e){this._entries=this._entries.filter(n=>n.id!==e)}removeAll(){this._entries=[]}set(e,n,o){for(let l=0;l<this._entries.length;l++)if(this._entries[l].id===e){this._entries[l]=new S(n,o,e),this._entries=[...this._entries];break}}getById(e){return this._entries.find(n=>n.id===e)??null}load(){const e=localStorage.getItem("PstPokeBox");if(e===null)return[];const n=JSON.parse(e);if(!Array.isArray(n))return[];const o=[];for(const l of n){if(typeof l!="string")continue;const u=this.deserializeItem(l);if(u!==null&&(o.push(new S(u.iv,u.nickname)),o.length>=C.maxEntryCount))break}this._entries=o}deserializeItem(e){const n=e.indexOf("@");let o=e,l="";n!==-1&&(o=e.substring(0,n),l=e.substring(n+1));try{return{iv:A.deserialize(o),nickname:l}}catch{return null}}save(){localStorage.setItem("PstPokeBox",JSON.stringify(this._entries.map(e=>e.serialize())))}}class S{_iv;_nickname;_id;static nextId=1;constructor(e,n,o){this._iv=e,this._nickname=n??"",this._id=o!==void 0?o:S.nextId++}serialize(){const e=this._iv.serialize();return this._nickname===""?e:e+"@"+this._nickname}get iv(){return this._iv}get nickname(){return this._nickname}get id(){return this._id}filledNickname(e){return this._nickname!==""?this._nickname:e(`pokemons.${this.iv.pokemonName}`)}}function J(i){if(navigator.clipboard)return navigator.clipboard.writeText(i);const e=document.createElement("textarea");e.readOnly=!0,e.value=i,e.style.position="absolute",e.style.opacity="0",document.body.appendChild(e),e.setSelectionRange(0,i.length);const n=document.execCommand("copy");return e.parentNode?.removeChild(e),n?Promise.resolve():Promise.reject()}class Q{name;filterTypes;filterSpecialty;ingredientName;ingredientUnlockedOnly;mainSkillNames;subSkillNames;subSkillUnlockedOnly;subSkillAnd;neutralNature;upNature;downNature;constructor(e){this.name=e.name??"",this.filterTypes=e.filterTypes??[],this.filterSpecialty=e.filterSpecialty??[],this.ingredientName=e.ingredientName,this.ingredientUnlockedOnly=e.ingredientUnlockedOnly??!1,this.mainSkillNames=e.mainSkillNames??[],this.subSkillNames=e.subSkillNames??[],this.subSkillUnlockedOnly=e.subSkillUnlockedOnly??!0,this.subSkillAnd=e.subSkillAnd??!0,this.neutralNature=e.neutralNature??!1,this.upNature=e.upNature??"No effect",this.downNature=e.downNature??"No effect"}filter(e,n,o){return e.filter(l=>this.matches(l,n,o))}matches(e,n,o){if(this.name!==""){const l=this.name.toLowerCase();if(e.nickname.toLowerCase().indexOf(this.name)===-1&&o(`pokemons.${e.iv.pokemonName}`).toLowerCase().indexOf(l)===-1)return!1}if(this.ingredientName!==void 0){const l=this.ingredientName,u=this.ingredientUnlockedOnly;if(!e.iv.getIngredients(u).includes(l))return!1}if(this.filterTypes.length!==0&&!this.filterTypes.includes(e.iv.pokemon.type)||this.filterSpecialty.length>0&&e.iv.pokemon.specialty!=="All"&&!this.filterSpecialty.includes(e.iv.pokemon.specialty)||this.mainSkillNames.length!==0&&!this.mainSkillNames.some(l=>T(e.iv.pokemon,l,n,e.iv)))return!1;if(this.subSkillNames.length!==0){const l=e.iv.subSkills.getActiveSubSkills(this.subSkillUnlockedOnly?e.iv.level:100).map(u=>u.name);if(this.subSkillAnd){if(!this.subSkillNames.every(u=>l.includes(u)))return!1}else if(!this.subSkillNames.some(u=>l.includes(u)))return!1}return!(this.neutralNature&&!e.iv.nature.isNeautral||this.upNature!=="No effect"&&e.iv.nature.upEffect!==this.upNature||this.downNature!=="No effect"&&e.iv.nature.downEffect!==this.downNature)}get defaultTabIndex(){return this.filterTypes.length>0||this.filterSpecialty.length>0?0:this.ingredientName!==void 0?1:this.mainSkillNames.length>0?2:this.subSkillNames.length>0?3:this.neutralNature||this.upNature!=="No effect"||this.downNature!=="No effect"?4:0}get isEmpty(){return this.name===""&&this.filterTypes.length===0&&this.filterSpecialty.length===0&&this.ingredientName===void 0&&this.mainSkillNames.length===0&&this.subSkillNames.length===0&&this.neutralNature===!1&&this.upNature==="No effect"&&this.downNature==="No effect"}}function Z(i,e,n,o,l,u,c,p){if(i.length===0)return[[],c("no pokemon found")];const m=((s,t)=>new B(s,t).calculate());if(i=[...i],e==="level"){const s=n?-1:1;return[i.sort((t,r)=>r.iv.level!==t.iv.level?r.iv.level-t.iv.level:r.iv.pokemon.id!==t.iv.pokemon.id?s*(r.iv.pokemon.id-t.iv.pokemon.id):r.iv.idForm!==t.iv.idForm?s*(r.iv.idForm-t.iv.idForm):r.id-t.id),""]}else{if(e==="name")return[i.sort((s,t)=>t.filledNickname(c)>s.filledNickname(c)?1:t.filledNickname(c)<s.filledNickname(c)?-1:t.iv.pokemon.id!==s.iv.pokemon.id?t.iv.pokemon.id-s.iv.pokemon.id:t.iv.idForm!==s.iv.idForm?t.iv.idForm-s.iv.idForm:t.id-s.id),""];if(e==="pokedexno")return[i.sort((s,t)=>t.iv.pokemon.id!==s.iv.pokemon.id?t.iv.pokemon.id-s.iv.pokemon.id:t.iv.idForm!==s.iv.idForm?t.iv.idForm-s.iv.idForm:t.iv.level!==s.iv.level?t.iv.level-s.iv.level:t.id-s.id),""];if(e==="rp"){const s={};return i.forEach(t=>{s[t.id]=new k(t.iv).Rp}),[i.sort((t,r)=>s[r.id]!==s[t.id]?s[r.id]-s[t.id]:r.iv.pokemon.id!==t.iv.pokemon.id?r.iv.pokemon.id-t.iv.pokemon.id:r.iv.level!==t.iv.level?r.iv.level-t.iv.level:r.id-t.id),""]}else if(e==="total strength"){const s={};return i.forEach(t=>{s[t.id]=m(t.iv,u).totalStrength}),[i.sort((t,r)=>s[r.id]!==s[t.id]?s[r.id]-s[t.id]:r.iv.pokemon.id!==t.iv.pokemon.id?r.iv.pokemon.id-t.iv.pokemon.id:r.id-t.id),""]}else if(e==="berry"){const s={};return i.forEach(t=>{s[t.id]=m(t.iv,u).berryTotalStrength}),[i.sort((t,r)=>s[r.id]!==s[t.id]?s[r.id]-s[t.id]:r.iv.pokemon.id!==t.iv.pokemon.id?r.iv.pokemon.id-t.iv.pokemon.id:r.id-t.id),""]}else if(e==="ingredient"){if(u.tapFrequency==="none")return[[],c("no ingredient")];const s={};i.forEach(r=>{const a=m(r.iv,u).ingredients;o==="count"?s[r.id]=a.reduce((f,g)=>f+g.count,0):o==="strength"?s[r.id]=a.reduce((f,g)=>f+g.strength,0):s[r.id]=a.find(f=>f.name===o)?.count??0});const t=i.filter(r=>s[r.id]>0).sort((r,a)=>s[a.id]!==s[r.id]?s[a.id]-s[r.id]:a.id-r.id);return[t,t.length>0?"":c("no pokemon found")]}else if(e==="skill"){if(u.tapFrequency==="none"||u.period<=H)return[[],c("no skill")];const s={};l==="strength"?i=i.filter(r=>!b(r.iv.pokemon.skill)):l!=="count"&&(i=i.filter(r=>T(r.iv.pokemon,l,u.evolved,r.iv))),i.forEach(r=>{const a=m(r.iv,u);if(l==="count"){s[r.id]=a.skillCount;return}if(l==="strength"){s[r.id]=a.skillStrength+a.skillStrength2;return}if(l==="Dream Shard Magnet S"){s[r.id]=a.skillValue;return}if(l==="Energy for Everyone S"&&r.iv.pokemon.skill==="Energy for Everyone S (Lunar Blessing)"){s[r.id]=a.skillValue;return}if(l==="Energizing Cheer S"&&a.skillValue2>0){s[r.id]=a.skillValue2;return}if(!b(r.iv.pokemon.skill)){s[r.id]=a.skillStrength+a.skillStrength2;return}s[r.id]=a.skillValue});const t=i.sort((r,a)=>s[a.id]!==s[r.id]?s[a.id]-s[r.id]:a.id-r.id);return[t,t.length>0?"":c("no pokemon found")]}}return[i,""]}function K(){const i={sort:"level",ingredient:"strength",mainSkill:"Energy for Everyone S",descending:!0,warnItems:0,warnDate:""},e=localStorage.getItem("PstPokemonBoxParam");if(e===null)return i;let n;try{n=JSON.parse(e)}catch{return i}return typeof n!="object"||n===null||(typeof n.sort=="string"&&["level","name","pokedexno","rp","berry","total strength","ingredient","skill count","skill"].includes(n.sort)&&(n.sort==="skill count"?i.sort="skill":i.sort=n.sort),typeof n.ingredient=="string"&&(n.ingredient==="strength"||n.ingredient==="count"||U.includes(n.ingredient))&&(i.ingredient=n.ingredient),typeof n.mainSkill=="string"&&(n.mainSkill==="strength"||n.mainSkill==="count"||O.includes(n.mainSkill))&&(i.mainSkill=n.mainSkill),typeof n.descending=="boolean"&&(i.descending=n.descending),typeof n.warnItems=="number"&&(i.warnItems=n.warnItems),typeof n.warnDate=="string"&&n.warnDate.match(/^\d{4}-\d{2}-\d{2}$/)&&(i.warnDate=n.warnDate)),i}const R=[0,0,54,125,233,361,525,727,971,1245,1560,1905,2281,2688,3107,3536,3976,4430,4899,5382,5879,6394,6931,7489,8068,8668,9290,9933,10598,11284,11992,12721,13469,14235,15020,15823,16644,17483,18340,19215,20108,21018,21946,22891,23854,24834,25831,26846,27878,28927,29993,31355,32917,34664,36610,38805,41084,43488,46021,48687,51493,54358,57280,60257,63286,66363],D=[0,0,14,18,22,27,30,34,39,44,48,50,52,53,56,59,62,66,68,71,74,78,81,85,88,92,95,100,105,111,117,122,126,130,136,143,151,160,167,174,184,192,201,211,221,227,236,250,264,279,295,309,323,338,356,372,391,437,486,538,593,651,698,750,804,866],$={600:1,900:1.5,1080:1.8,1320:2.2};function X(i,e,n,o){const l=i.level;if(l<0||l>v||n<0||n>v||l>=n)return{exp:0,candy:0,shards:0};const u=F(l,n,i)-e;let c=0,p=0,m=e;const s=o==="none"?1:o==="mini"?4:5;for(let t=l;t<n;t++){const r=F(t,t+1,i)-m,a=q(t,i.nature,o),f=Math.ceil(r/a);c+=D[t+1]*f*s,p+=Math.ceil(r/a),m=a*f-r}return{exp:u,candy:p,shards:c}}function q(i,e,n){const o=n!=="none"?2:1;return i<25?(e.isExpGainsUp?41:e.isExpGainsDown?29:35)*o:i<30?(e.isExpGainsUp?35:e.isExpGainsDown?25:30)*o:(e.isExpGainsUp?30:e.isExpGainsDown?21:25)*o}function F(i,e,n){const o=$[n.pokemon.exp];return i<0||i>v||e<0||e>v?0:Math.round(R[e]*o)-Math.round(R[i]*o)}function z(i){i=Math.round(i*10);const e=(i%10).toString();return`${y(i/10)}.${e}`}function j(i){i=Math.round(i*100);const e=(i%100).toString().padStart(2,"0");return`${y(i/100)}.${e}`}function Y(i){i=Math.round(i*1e3);const e=(i%1e3).toString().padStart(3,"0");return`${y(i/1e3)}.${e}`}function y(i){const e=[];for(i=Math.floor(i);i>=1e3;)e.push((i%1e3).toString().padStart(3,"0")),i=Math.floor(i/1e3);return e.push(i.toString()),e.reverse(),e.join(",")}function ee(i,e){if(i<10)return j(i);if(i<1e3)return z(i);if(i<1e5)return y(Math.round(i));const n=e("short num unit digits");if(n==="4")return(i/1e4).toFixed(1).toString()+e("short num unit");if(n==="3")return(i/1e3).toFixed(0).toString()+e("short num unit");throw new Error("unknown short num digits: "+n)}class ie{pokemonName;pokemon;iv;rp;constructor(e){this.pokemonName=e.pokemonName,this.pokemon=e.pokemon,this.iv=e,this.rp=new k(e)}calculate(){if(this.pokemon.frequency===0)return{berryScore:0,berryMax:0,berryCur:0,berryRatio:0,ingScore:0,ingMax:0,ingCur:0,ingRatio:0,skillScore:0,skillMax:0,skillCur:0,skillRatio:0};const e=new k(this.iv);e.subSkills=new w([new d("Berry Finding S"),new d("Helping Bonus"),new d("Helping Speed M"),new d("Helping Speed S"),null]),e.nature=new x("Adamant");const n=new k(this.iv);n.subSkills=new w([new d("Ingredient Finder M"),new d("Ingredient Finder S"),new d("Helping Speed M"),new d("Helping Speed S"),new d("Helping Bonus")]),n.nature=new x("Quiet");const o=new k(this.iv);o.subSkills=new w([new d("Skill Trigger M"),new d("Skill Trigger S"),new d("Helping Speed M"),new d("Helping Speed S"),new d("Helping Bonus")]),o.nature=new x("Sassy");const l=h=>{let N=3600/h.frequencyWithHelpingBonus(0)*h.berryRatio*h.berryCount;return h.hasHelpingBonusInActiveSubSkills&&(N+=N/h.berryCount*6*.0526),N},u=l(e),c=l(this.rp),p=c/u*100,m=this.rp.berryRatio,s=h=>3600/h.frequencyWithHelpingBonus(0)*h.ingredientRatio,t=s(n),r=s(this.rp),a=r/t*100,f=this.rp.ingredientRatio,g=h=>3600/h.frequencyWithHelpingBonus(0)*h.skillRatio,E=g(o),M=g(this.rp),I=M/E*100,P=this.rp.skillRatio;return{berryScore:p,berryMax:u,berryCur:c,berryRatio:m,ingScore:a,ingMax:t,ingCur:r,ingRatio:f,skillScore:I,skillMax:E,skillCur:M,skillRatio:P}}}export{L as A,Q as B,C as P,_ as R,F as a,X as b,J as c,j as d,Y as e,y as f,W as g,ee as h,ie as i,S as j,K as l,z as r,Z as s};
